[[use-simple-persistence-store]]
= Using a Simple Persistence Store

[[overview]]
== Overview

The raincatcher-store-simple module:
* uses current functionality in the mediator ArrayStore
* uses the
https://access.redhat.com/documentation/en/red-hat-mobile-application-platform-hosted/3/paged/cloud-api/chapter-2-fhdb[$fh.db
Cloud API] to store data in a mongo database
* allow users to control whether the memory store or the MongoDB store
is used

[[example-use-simple-persistence-store-for-workorders-in-cloud-app]]
== Example: Use Simple Persistence Store for workorders in Cloud App

. Create list of of workorders to be saved into Simple Store
+
[source,js]
----
var workorders = [
    { id: "rkX1fdSH", workflowId: 'SyVXyMuSr', assignee: 'rkX1fdSH', type: 'Job Order', title: 'Footpath in disrepair', status: 'New', startTimestamp: '2015-10-22T14:00:00Z', address: '1795 Davie St, Vancouver, BC V6G 2M9', location: [49.287227, -123.141489], summary: 'Please remove damaged kerb and SUPPLY AND FIX 1X DROP KERB CENTRE BN 125 X 150 cart away from site outside number 3.'},
  ...
    { id: "BkuXajsIB", workflowId: 'SyVXyMuSr', assignee: null, type: 'Job Order', title: 'Sink in disrepair', status: 'New', startTimestamp: '2015-10-22T07:00:00Z', address: '3820 Oak St, Vancouver, BC V6H 2M5', location: [49.251362, -123.127070], summary: 'Please remove damaged kerb and SUPPLY AND FIX 1X DROP KERB CENTRE BN 125 X 150 cart away from site outside number 3.'};
];
----

. Create a simple store in your Cloud App
+
[source,js]
----
const SimpleStore = require('fh-wfm-simple-store')({persistent: true});
const simpleStore = new SimpleStore('workorders');
simpleStore.init({/* init with data */}).then(function() {
  // store is available for use
});
----

. Register CRUD topics for the workorders
+
Specify a prefix for all data topics in the data store(e.g.
`:cloud:data`)
+
[source,js]
----
simpleStore.listen('cloud:data', mediator);
----

. Publish a create topic to create the workorders
+
Each topic should be picked up by the workorder module which afterwards
publishes the data store topic
+
[source,js]
----
workorders.forEach(function(workorder) {    
    mediator.publish('cloud:data:' + config.datasetId + ':create', workorder, {uid: workorder.id});
});
----

. Optionally, switch between memory store and persistent store.
+
.. To use ArrayStore set the `WFM_USE_MEMORY_STORE`
environment variable to `true`
image:assets/images/add-simple-store-env-var.png[Add
`WFM_USE_MEMORY_STORE` Env Var]
+
.. Push environment variables
.. Restart the Cloud App.
+
Otherwise
https://access.redhat.com/documentation/en/red-hat-mobile-application-platform-hosted/3/paged/cloud-api/chapter-2-fhdb[$fh.db
Cloud API] store will be used for data persistence
image:assets/images/push-simple-store-env-var.png[Push
`WFM_USE_MEMORY_STORE` Env Var]

=== Removing Data Using the Data Browser

If you want to remove data from Data Browser in the deployed
raincatcher-demo-cloud and raincatcher-demo-auth applications:

. Open the data browser in side bar.

. Determine what data from collections you want to remove:
image:assets/images/remove-data-from-data-browser.png[Remove data from
Data Browser].

. Remove the data.

=== Resetting a persistent storage raincatcher project


*Important: this functionality intended to be used for development and
demo purposes only and should not be included in a production
application*

In case you want all data to be reset to the default state there is an
option to reset all data inside the Portal App
image:assets/images/reset-all-data-in-portal-app.png[Reset all data in
Portal App]
